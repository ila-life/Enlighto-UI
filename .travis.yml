os: linux

language: android

android:
  components:
    - tools
    - platform-tools
    - tools
    - build-tools-28.0.3
    - android-28
    - extra-google-google_play_services
    - extra-google-m2repository
    - extra-android-m2repository
  licenses:
    - android-sdk-preview-license-.+
    - android-sdk-license-.+
    - google-gdk-license-.+

addons:
  apt:
    sources:
      - sourceline: deb https://dl.yarnpkg.com/debian/ stable main
        key_url: https://dl.yarnpkg.com/debian/pubkey.gpg
    packages:
      - oracle-java8-installer
      - oracle-java8-set-default

before_install:
  - export LANG=en_US.UTF-8
  - nvm install 10.15.2
  - npm install -g cordova ionic
  - npm install

script:
  - ionic cordova build android --release
  - mkdir -p output
  - cp platforms/android/app/build/outputs/apk/release/app-release-unsigned.apk output/ionictravis-release-unsigned.apk

env:
  global:
    - JAVA_HOME=/usr/lib/jvm/java-8-oracle

deploy:
  provider: releases
  api_key:
    secure: <GITHUB_TOKEN>
  file_glob: true
  file: output/*
  skip_cleanup: true
  overwrite: true
  on:
    branch: master
